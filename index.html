<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cartão</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --glass-bg: rgba(15, 23, 42, 0.45);
      --glass-border: rgba(255, 255, 255, 0.16);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --accent-start: #38bdf8;
      --accent-end: #a855f7;
      --error: #fb7185;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      background:
        radial-gradient(circle at top, #1f2937 0, #020617 45%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      padding: 16px;
      padding-top: max(16px, env(safe-area-inset-top));
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .shell {
      width: 100%;
      max-width: 420px;
      margin: 10vh auto 0;
    }

    .card {
      position: relative;
      width: 100%;
      padding: 22px 18px 20px;
      border-radius: 22px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      box-shadow:
        0 26px 60px rgba(0, 0, 0, 0.85),
        0 0 0 0.5px rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(26px) saturate(160%);
      -webkit-backdrop-filter: blur(26px) saturate(160%);
      overflow: hidden;

      opacity: 0;
      transform: translateY(14px) scale(0.97);
      pointer-events: none;
      transition:
        opacity 0.35s ease-out,
        transform 0.35s ease-out;
    }

    .card.is-active {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at top left, rgba(255, 255, 255, 0.14), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.14), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .text {
      font-size: 0.98rem;
      line-height: 1.5;
      color: var(--text-main);
      margin-bottom: 18px;
    }

    .password-input {
      width: 100%;
      padding: 11px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(15, 23, 42, 0.92);
      color: var(--text-main);
      font-size: 0.95rem;
      outline: none;
      transition:
        border-color 0.2s ease,
        box-shadow 0.2s ease,
        background 0.2s ease,
        transform 0.15s ease;
      margin-bottom: 12px;
    }

    .password-input::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }

    .password-input:focus {
      border-color: rgba(56, 189, 248, 0.9);
      box-shadow:
        0 0 0 1px rgba(56, 189, 248, 0.8),
        0 0 18px rgba(56, 189, 248, 0.4);
      background: rgba(15, 23, 42, 1);
      transform: translateY(-0.5px);
    }

    .btn-primary {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 0.98rem;
      font-weight: 500;
      color: #020617;
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow:
        0 0 18px rgba(56, 189, 248, 0.5),
        0 0 34px rgba(168, 85, 247, 0.35);
      transition:
        transform 0.14s ease,
        box-shadow 0.14s ease,
        filter 0.14s ease;
    }

    .btn-primary::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.26), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.975);
      box-shadow:
        0 0 10px rgba(56, 189, 248, 0.4),
        0 0 20px rgba(168, 85, 247, 0.25);
      filter: brightness(0.97);
    }

    .btn-primary:focus-visible {
      outline: 2px solid rgba(56, 189, 248, 0.9);
      outline-offset: 3px;
    }

    .error {
      min-height: 1.2em;
      font-size: 0.86rem;
      color: var(--error);
      margin-top: 6px;
      transition: opacity 0.2s ease;
      opacity: 0;
    }

    .error.has-text {
      opacity: 1;
    }

    /* ============================
       TELA 2: AR COM CÂMERA + HIRO
       ============================ */

    .ar-screen {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      background: #000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s ease-out;
    }

    .ar-screen.is-active {
      opacity: 1;
      pointer-events: auto;
    }

    .ar-scene-wrapper {
      width: 100%;
      height: 100%;
    }

    .ar-scene-wrapper a-scene {
      width: 100% !important;
      height: 100% !important;
    }

    .ar-overlay-box {
      position: absolute;
      top: max(12px, env(safe-area-inset-top));
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      max-width: min(92%, 420px);
      padding: 10px 14px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.82);
      border: 1px solid rgba(255, 255, 255, 0.16);
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.7),
        0 0 0 0.4px rgba(148, 163, 184, 0.3);
      backdrop-filter: blur(18px) saturate(150%);
      -webkit-backdrop-filter: blur(18px) saturate(150%);
    }

    .ar-overlay-text {
      font-size: 0.9rem;
      line-height: 1.4;
      color: #e5e7eb;
      text-align: left;
    }

    .ar-warning {
      position: absolute;
      bottom: max(12px, env(safe-area-inset-bottom));
      left: 50%;
      transform: translateX(-50%);
      z-index: 11;
      max-width: min(92%, 420px);
      font-size: 0.78rem;
      line-height: 1.4;
      color: #f97373;
      text-align: center;
      padding: 6px 10px;
      background: rgba(15, 23, 42, 0.78);
      border-radius: 999px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .ar-warning.visible {
      opacity: 1;
    }

    @media (prefers-reduced-motion: reduce) {
      .card,
      .ar-screen {
        transition: none;
        transform: none;
      }
      .btn-primary,
      .password-input {
        transition: none;
      }
    }
  </style>
</head>
<body>
  <main class="shell" id="shell-root">
    <!-- TELA 1: SENHA -->
    <section class="card is-active" id="lock-screen">
      <div class="card-inner">
        <p class="text">
          Só quem sabe a senha pode ver o que tem aqui dentro.
        </p>

        <input
          id="password"
          class="password-input"
          type="text"
          placeholder="Uma data especial ❣️"
          autocomplete="off"
          inputmode="numeric"
        />

        <button class="btn-primary" id="unlock-btn">Ver mensagem</button>

        <div id="error" class="error"></div>
      </div>
    </section>
  </main>

  <!-- TELA 2: AR + CÂMERA EM TELA CHEIA -->
  <div class="ar-screen" id="ar-screen">
    <div class="ar-overlay-box">
      <p class="ar-overlay-text">
        Agora, mire a câmera no marcador Hiro que está no verso do cartão.
      </p>
    </div>

    <div class="ar-warning" id="camera-warning">
      Se a câmera não aparecer, abra este link no Safari ou Chrome.  
      Alguns apps (WhatsApp/Instagram) bloqueiam a câmera em telas internas.
    </div>

    <div class="ar-scene-wrapper">
      <a-scene
        embedded
        vr-mode-ui="enabled: false"
        renderer="alpha: true; antialias: true; precision: mediump;"
        arjs="sourceType: webcam; debugUIEnabled: false;"
      >
        <a-assets>
          <!-- vídeo da mensagem; deve estar no mesmo diretório -->
          <video
            id="mensagemVideo"
            src="mensagem.mp4"
            preload="auto"
            webkit-playsinline
            playsinline
            crossorigin="anonymous"
            loop
          ></video>
        </a-assets>

        <!-- Marcador Hiro -->
        <a-marker preset="hiro">
          <a-video
            src="#mensagemVideo"
            width="1.4"
            height="0.79"
            position="0 0 0"
            rotation="0 0 0"
          ></a-video>
        </a-marker>

        <a-entity camera></a-entity>
      </a-scene>
    </div>
  </div>

  <script>
    // Senha correta no formato DDMMAAAA
    const CORRECT_PASSWORD = "29092024";

    const passwordInput = document.getElementById("password");
    const errorEl = document.getElementById("error");
    const lockScreen = document.getElementById("lock-screen");
    const unlockBtn = document.getElementById("unlock-btn");
    const arScreen = document.getElementById("ar-screen");
    const cameraWarning = document.getElementById("camera-warning");

    function unlock() {
      const value = passwordInput.value.trim();

      if (value === CORRECT_PASSWORD) {
        errorEl.textContent = "";
        errorEl.classList.remove("has-text");

        // Esconde o card com a senha
        lockScreen.classList.remove("is-active");

        // Mostra a tela AR em full screen
        arScreen.classList.add("is-active");

        // Tenta iniciar o vídeo na superfície do marcador
        const vid = document.getElementById("mensagemVideo");
        if (vid) {
          vid.play().catch(() => {});
        }

        // Checa suporte básico de câmera
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          cameraWarning.classList.add("visible");
        }
      } else {
        errorEl.textContent = "Ops! Essa não é a senha.";
        errorEl.classList.add("has-text");
      }
    }

    unlockBtn.addEventListener("click", unlock);

    // Enter também dispara o desbloqueio
    passwordInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        unlock();
      }
    });
  </script>
</body>
</html>
